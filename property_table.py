#!/bin/env python

"""
property_table.py

This file contains all the properties that can be calculated by SOAP, and some
functionality to automatically generate the documentation (PDF) containing these
properties.

The rationale for having all of this in one file (and what is essentially one
big dictionary) is consistency: every property is defined exactly once, with
one data type, one unit, one description... Every type of halo still
implements its own calculation of each property, but everything that is exposed
to the user is guaranteed to be consistent for all halo types. To change the
documentation, you need to change the dictionary, so you will automatically
change the code as well. If you remember to regenerate the documentation, the
code will hence always be consistent with its documentation. The documentation
includes a version string to help identify it.

When a specific type of halo wants to implement a property, it should import the
property table from this file and grab all of the information for the
corresponding dictionary element, e.g. (taken from aperture_properties.py)

    from property_table import PropertyTable
    property_list = [
        (prop, *PropertyTable.full_property_list[prop])
        for prop in [
            "Mtot",
            "Mgas",
            "Mdm",
            "Mstar",
        ]
    ]

The elements of each row are documented later in this file.

Note that this file contains some code that helps to regenerate the dictionary
itself. That is useful for adding additional rows to the table.
"""

import numpy as np
import unyt
import subprocess
import datetime
import os
from typing import Dict, List
from halo_properties import HaloProperty


def get_version_string() -> str:
    """
    Generate a version string that uniquely identifies the documentation file.

    The version string will have the format
      SOAP version a7baa6e -- Compiled by user ``vandenbroucke'' on winkel
       on Tuesday 15 November 2022, 10:49:10
    or
      Unknown SOAP version -- Compiled by user ``vandenbroucke'' on winkel
       on Tuesday 15 November 2022, 10:49:10
    if no git version string can be obtained.
    """

    handle = subprocess.run("git describe --always", shell=True, stdout=subprocess.PIPE)
    if handle.returncode != 0:
        git_version = "Unknown SOAP version"
    else:
        git_version = handle.stdout.decode("utf-8").strip()
        git_version = f"SOAP version ``{git_version}''"
    timestamp = datetime.datetime.now().strftime("%A %-d %B %Y, %H:%M:%S")
    username = os.getlogin()
    hostname = os.uname().nodename
    return f"Generated by user ``{username}'' on {hostname} on {timestamp}. {git_version}"


def word_wrap_name(name):
    """
    Put a line break in if a name gets too long
    """
    maxlen = 20
    count = 0
    output = []
    last_was_lower = False
    for i in range(len(name)):
        next_char = name[i]
        count += 1
        if count > maxlen and next_char.isupper() and last_was_lower:
            output.append(r"\-")
        output.append(next_char)
        last_was_lower = next_char.isupper() == False
    return "".join(output)


class PropertyTable:
    """
    Auxiliary object to manipulate the property table.

    You should only create a PropertyTable object if you actually want to use
    it to generate an updated version of the internal property dictionary or
    to generate the documentation. If you just want to grab the information for
    a particular property from the table, you should directly access the
    static table, e.g.
      Mstar_info = PropertyTable.full_property_list["Mstar"]
    """

    # some properties require an additional explanation in the form of a
    # footnote. These footnotes are .tex files in the 'documentation' folder
    # (that should exist). The name of the file acts as a key in the dictionary
    # below; the corresponding value is a list of all properties that should
    # include a footnote link to this particular explanation.
    explanation = {
        "footnote_MBH.tex": ["BHmaxM"],
        "footnote_com.tex": ["com", "vcom"],
        "footnote_AngMom.tex": ["Lgas", "Ldm", "Lstar", "Lbaryons"],
        "footnote_kappa.tex": [
            "kappa_corot_gas",
            "kappa_corot_star",
            "kappa_corot_baryons",
        ],
        "footnote_SF.tex": [
            "SFR",
            "gasFefrac_SF",
            "gasOfrac_SF",
            "Mgas_SF",
            "gasmetalfrac_SF",
        ],
        "footnote_Tgas.tex": [
            "Tgas",
            "Tgas_no_agn",
            "Tgas_no_cool",
            "Tgas_no_cool_no_agn",
        ],
        "footnote_lum.tex": ["StellarLuminosity"],
        "footnote_circvel.tex": ["R_vmax", "Vmax", "Vmax_soft"],
        "footnote_spin.tex": ["spin_parameter"],
        "footnote_veldisp_matrix.tex": [
            "veldisp_matrix_gas",
            "veldisp_matrix_dm",
            "veldisp_matrix_star",
        ],
        "footnote_proj_veldisp.tex": [
            "proj_veldisp_gas",
            "proj_veldisp_dm",
            "proj_veldisp_star",
        ],
        "footnote_elements.tex": [
            "gasOfrac",
            "gasOfrac_SF",
            "gasFefrac",
            "gasFefrac_SF",
            "gasmetalfrac",
            "gasmetalfrac_SF",
        ],
        "footnote_halfmass.tex": [
            "HalfMassRadiusTot",
            "HalfMassRadiusGas",
            "HalfMassRadiusDM",
            "HalfMassRadiusStar",
        ],
        "footnote_satfrac.tex": ["Mfrac_satellites", "Mfrac_external"],
        "footnote_Ekin.tex": ["Ekin_gas", "Ekin_star"],
        "footnote_Etherm.tex": ["Etherm_gas"],
        "footnote_Mnu.tex": ["Mnu", "MnuNS"],
        "footnote_Xray.tex": [
            "Xraylum",
            "Xraylum_restframe",
            "Xrayphlum",
            "Xrayphlum_restframe",
        ],
        "footnote_compY.tex": ["compY", "compY_no_agn"],
        "footnote_dopplerB.tex": ["DopplerB"],
        "footnote_coreexcision.tex": [
            "Tgas_cy_weighted_core_excision",
            "Tgas_cy_weighted_core_excision_no_agn",
            "Tgas_core_excision",
            "Tgas_no_cool_core_excision",
            "Tgas_no_agn_core_excision",
            "Tgas_no_cool_no_agn_core_excision",
            "Xraylum_core_excision",
            "Xraylum_no_agn_core_excision",
            "Xrayphlum_core_excision",
            "Xrayphlum_no_agn_core_excision",
            "SpectroscopicLikeTemperature_core_excision",
            "SpectroscopicLikeTemperature_no_agn_core_excision",
        ],
        "footnote_cytemp.tex": [
            "Tgas_cy_weighted",
            "Tgas_cy_weighted_no_agn",
            "Tgas_cy_weighted_core_excision",
            "Tgas_cy_weighted_core_excision_no_agn",
        ],
        "footnote_spectroscopicliketemperature.tex": [
            "SpectroscopicLikeTemperature",
            "SpectroscopicLikeTemperature_core_excision",
            "SpectroscopicLikeTemperature_no_agn",
            "SpectroscopicLikeTemperature_no_agn_core_excision",
        ],
        "footnote_dust.tex": [
            "DustGraphiteMass",
            "DustGraphiteMassInMolecularGas",
            "DustGraphiteMassInAtomicGas",
            "DustSilicatesMass",
            "DustSilicatesMassInMolecularGas",
            "DustSilicatesMassInAtomicGas",
            "DustLargeGrainMass",
            "DustLargeGrainMassInMolecularGas",
            "DustSmallGrainMass",
            "DustSmallGrainMassInMolecularGas",
        ],
        "footnote_diffuse.tex": [
            "DiffuseCarbonMass",
            "DiffuseOxygenMass",
            "DiffuseMagnesiumMass",
            "DiffuseSiliconMass",
            "DiffuseIronMass",
        ],
        "footnote_concentration.tex": [
            "concentration",
            "concentration_soft",
            "concentration_dmo",
            "concentration_dmo_soft",
        ],
    }

    # dictionary with human-friendly descriptions of the various lossy
    # compression filters that can be applied to data.
    # The key is the name of a lossy compression filter (same names as used
    # by SWIFT), the value is the corresponding description, which can be either
    # an actual description or a representative example.
    compression_description = {
        "FMantissa9": "$1.36693{\\rm{}e}10 \\rightarrow{} 1.367{\\rm{}e}10$",
        "DMantissa9": "$1.36693{\\rm{}e}10 \\rightarrow{} 1.367{\\rm{}e}10$",
        # TODO: This filter was introduced because of a hdf5 check on file integrity
        # We should switch back to DMantissa9 when possible
        # See https://docs.hdfgroup.org/hdf5/v1_14/group___f_a_p_l.html#gafa8e677af3200e155e9208522f8e05c0
        "DMantissa21": "$1.3669381{\\rm{}e}10 \\rightarrow{} 1.366938{\\rm{}e}10$",
        "DScale5": "10 pc accurate",
        "DScale1": "0.1 km/s accurate",
        "Nbit40": "Store less bits",
        "None": "no compression",
    }

    # List of properties that get computed
    # The key for each property is the name that is used internally in SOAP
    # For each property, we have the following columns:
    #  - name: Name of the property within the output file
    #  - shape: Shape of this property for a single halo (1: scalar,
    #      3: vector...)
    #  - dtype: Data type that will be used. Should have enough precision to
    #      avoid over/underflow
    #  - unit: Units that will be used internally and for the output.
    #  - description: Description string that will be used to describe the
    #      property in the output.
    #  - category: Category used to decide if this property should be calculated
    #      for a particular halo (filtering).
    #  - lossy compression filter: Lossy compression filter used in the output
    #      to reduce the file size. Note that SOAP does not actually compress
    #      the output; this is done by a separate script. We support all lossy
    #      compression filters available in SWIFT.
    #  - DMO property: Should this property be calculated for a DMO run?
    #  - Particle properties: Particle fields that are required to compute this
    #      property. Used to determine which particle fields to read for a
    #      particular SOAP configuration (as defined in the parameter file).
    #  - Output physical: Whether to output this value as physical or co-moving.
    #  - a-scale exponent: What a-scale exponent to set for this property. If set
    #      to None this marks that the property can not be converted to comoving
    #
    # Note that there is no good reason to have a diffent internal name and
    # output name; this was mostly done for historical reasons. This means that
    # you can easily change the name in the output without having to change all
    # of the other .py files that use this property.
    full_property_list = {
        "AtomicHydrogenMass": (
            "AtomicHydrogenMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in atomic hydrogen.",
            "basic",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "BHlasteventa": (
            "BlackHolesLastEventScalefactor",
            1,
            np.float32,
            "dimensionless",
            "Scale-factor of last AGN event.",
            "general",
            "FMantissa9",
            False,
            ["PartType5/LastAGNFeedbackScaleFactors"],
            True,
            None,
        ),
        "BHmaxAR": (
            "MostMassiveBlackHoleAccretionRate",
            1,
            np.float32,
            "snap_mass/snap_time",
            "Gas accretion rate of most massive black hole.",
            "general",
            "FMantissa9",
            False,
            ["PartType5/SubgridMasses", "PartType5/AccretionRates"],
            True,
            None,
        ),
        "BHmaxID": (
            "MostMassiveBlackHoleID",
            1,
            np.uint64,
            "dimensionless",
            "ID of most massive black hole.",
            "basic",
            "Nbit40",
            False,
            ["PartType5/SubgridMasses", "PartType5/ParticleIDs"],
            True,
            None,
        ),
        "BHmaxM": (
            "MostMassiveBlackHoleMass",
            1,
            np.float32,
            "snap_mass",
            "Mass of most massive black hole.",
            "basic",
            "FMantissa9",
            False,
            ["PartType5/SubgridMasses"],
            True,
            0,
        ),
        "BHmaxlasteventa": (
            "MostMassiveBlackHoleLastEventScalefactor",
            1,
            np.float32,
            "dimensionless",
            "Scale-factor of last AGN event for most massive black hole.",
            "general",
            "FMantissa9",
            False,
            ["PartType5/SubgridMasses", "PartType5/LastAGNFeedbackScaleFactors"],
            True,
            None,
        ),
        "BHmaxpos": (
            "MostMassiveBlackHolePosition",
            3,
            np.float64,
            "snap_length",
            "Position of most massive black hole.",
            "general",
            "DScale5",
            False,
            ["PartType5/Coordinates", "PartType5/SubgridMasses"],
            False,
            1,
        ),
        "BHmaxvel": (
            "MostMassiveBlackHoleVelocity",
            3,
            np.float32,
            "snap_length/snap_time",
            "Velocity of most massive black hole relative to the simulation volume.",
            "general",
            "FMantissa9",
            False,
            ["PartType5/SubgridMasses", "PartType5/Velocities"],
            False,
            1,
        ),
        "DarkMatterInertiaTensor": (
            "DarkMatterInertiaTensor",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed iteratively from the DM mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Coordinates", "PartType1/Masses"],
            True,
            2,
        ),
        "DarkMatterInertiaTensorReduced": (
            "DarkMatterInertiaTensorReduced",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed iteratively from the DM mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Coordinates", "PartType1/Masses"],
            True,
            0,
        ),
        "DarkMatterInertiaTensorNoniterative": (
            "DarkMatterInertiaTensorNoniterative",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed in a single interation from the DM mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Coordinates", "PartType1/Masses"],
            True,
            2,
        ),
        "DarkMatterInertiaTensorReducedNoniterative": (
            "DarkMatterInertiaTensorReducedNoniterative",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed in a single interation from the DM mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Coordinates", "PartType1/Masses"],
            True,
            0,
        ),
        "DM_R_vmax": (
            "MaximumDarkMatterCircularVelocityRadius",
            1,
            np.float32,
            "snap_length",
            "Radius at which Vmax is reached for dark matter particles.",
            "dm",
            "FMantissa9",
            False,
            ["PartType1/Coordinates", "PartType1/Masses"],
            False,
            1,
        ),
        "DM_Vmax": (
            "MaximumDarkMatterCircularVelocity",
            1,
            np.float32,
            "snap_length/snap_time",
            "Maximum circular velocity calculated using dark matter particles.",
            "dm",
            "FMantissa9",
            False,
            ["PartType1/Coordinates", "PartType1/Masses"],
            True,
            0,
        ),
        "DiffuseCarbonMass": (
            "DiffuseCarbonMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in carbon that is not contained in dust.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractionsDiffuse"],
            True,
            0,
        ),
        "DiffuseIronMass": (
            "DiffuseIronMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in iron that is not contained in dust.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractionsDiffuse"],
            True,
            0,
        ),
        "DiffuseMagnesiumMass": (
            "DiffuseMagnesiumMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in magnesium that is not contained in dust.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractionsDiffuse"],
            True,
            0,
        ),
        "DiffuseOxygenMass": (
            "DiffuseOxygenMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in oxygen that is not contained in dust.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractionsDiffuse"],
            True,
            0,
        ),
        "DiffuseSiliconMass": (
            "DiffuseSiliconMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in silicon that is not contained in dust.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractionsDiffuse"],
            True,
            0,
        ),
        "DopplerB": (
            "DopplerB",
            1,
            np.float32,
            "dimensionless",
            "Kinetic Sunyaey-Zel'dovich effect, assuming a line of sight towards the position of the first lightcone observer.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Velocities",
                "PartType0/ElectronNumberDensities",
                "PartType0/Densities",
            ],
            False,
            1,
        ),
        "DtoTgas": (
            "DiscToTotalGasMassFraction",
            1,
            np.float32,
            "dimensionless",
            "Fraction of the total gas mass that is co-rotating.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses", "PartType0/Velocities"],
            True,
            0,
        ),
        "DtoTstar": (
            "DiscToTotalStellarMassFraction",
            1,
            np.float32,
            "dimensionless",
            "Fraction of the total stellar mass that is co-rotating.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Velocities", "PartType4/Masses"],
            True,
            0,
        ),
        "DustGraphiteMass": (
            "DustGraphiteMass",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in graphite grains.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/DustMassFractions"],
            True,
            0,
        ),
        "DustGraphiteMassInAtomicGas": (
            "DustGraphiteMassInAtomicGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in graphite grains in atomic gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/ElementMassFractions",
                "PartType0/SpeciesFractions",
            ],
            True,
            0,
        ),
        "DustGraphiteMassInMolecularGas": (
            "DustGraphiteMassInMolecularGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in graphite grains in molecular gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "DustGraphiteMassInColdDenseGas": (
            "DustGraphiteMassInColdDenseGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in graphite grains in cold, dense gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/Densities",
                "PartType0/Temperatures",
            ],
            True,
            0,
        ),
        "DustLargeGrainMass": (
            "DustLargeGrainMass",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in large grains.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/DustMassFractions"],
            True,
            0,
        ),
        "DustLargeGrainMassInMolecularGas": (
            "DustLargeGrainMassInMolecularGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in large grains in molecular gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "DustLargeGrainMassInColdDenseGas": (
            "DustLargeGrainMassInColdDenseGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in large grains in cold, dense gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/Densities",
                "PartType0/Temperatures",
            ],
            True,
            0,
        ),
        "DustSilicatesMass": (
            "DustSilicatesMass",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in silicate grains.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/DustMassFractions"],
            True,
            0,
        ),
        "DustSilicatesMassInAtomicGas": (
            "DustSilicatesMassInAtomicGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in silicate grains in atomic gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "DustSilicatesMassInMolecularGas": (
            "DustSilicatesMassInMolecularGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in silicate grains in molecular gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "DustSilicatesMassInColdDenseGas": (
            "DustSilicatesMassInColdDenseGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in silicate grains in cold, dense gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/Densities",
                "PartType0/Temperatures",
            ],
            True,
            0,
        ),
        "DustSmallGrainMass": (
            "DustSmallGrainMass",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in small grains.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "DustSmallGrainMassInMolecularGas": (
            "DustSmallGrainMassInMolecularGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in small grains in molecular gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "DustSmallGrainMassInColdDenseGas": (
            "DustSmallGrainMassInColdDenseGas",
            1,
            np.float32,
            "snap_mass",
            "Total dust mass in small grains in cold, dense gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/DustMassFractions",
                "PartType0/Densities",
                "PartType0/Temperatures",
            ],
            True,
            0,
        ),
        "Ekin_gas": (
            "KineticEnergyGas",
            1,
            np.float64,
            "snap_mass*snap_length**2/snap_time**2",
            "Total kinetic energy of the gas, relative to the gas centre of mass velocity.",
            "gas",
            "DMantissa21",
            False,
            ["PartType0/Masses", "PartType0/Velocities"],
            True,
            -2,
        ),
        "Ekin_star": (
            "KineticEnergyStars",
            1,
            np.float64,
            "snap_mass*snap_length**2/snap_time**2",
            "Total kinetic energy of the stars, relative to the stellar centre of mass velocity.",
            "star",
            "DMantissa21",
            False,
            ["PartType4/Masses", "PartType4/Velocities"],
            True,
            -2,
        ),
        "Etherm_gas": (
            "ThermalEnergyGas",
            1,
            np.float64,
            "snap_mass*snap_length**2/snap_time**2",
            "Total thermal energy of the gas.",
            "general",
            "DMantissa21",
            False,
            ["PartType0/Densities", "PartType0/Pressures", "PartType0/Masses"],
            True,
            -2,
        ),
        "GasInertiaTensor": (
            "GasInertiaTensor",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed iteratively from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            2,
        ),
        "GasInertiaTensorReduced": (
            "GasInertiaTensorReduced",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed iteratively from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            0,
        ),
        "GasInertiaTensorNoniterative": (
            "GasInertiaTensorNoniterative",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed in a single iteration from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            2,
        ),
        "GasInertiaTensorReducedNoniterative": (
            "GasInertiaTensorReducedNoniterative",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed in a single iteration from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            0,
        ),
        "HalfMassRadiusBaryon": (
            "HalfMassRadiusBaryons",
            1,
            np.float32,
            "snap_length",
            "Baryonic (gas and stars) half mass radius.",
            "baryon",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
            ],
            False,
            1,
        ),
        "HalfMassRadiusDM": (
            "HalfMassRadiusDarkMatter",
            1,
            np.float32,
            "snap_length",
            "Dark matter half mass radius.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Coordinates", "PartType1/Masses"],
            False,
            1,
        ),
        "HalfMassRadiusGas": (
            "HalfMassRadiusGas",
            1,
            np.float32,
            "snap_length",
            "Gas half mass radius.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            False,
            1,
        ),
        "HalfMassRadiusStar": (
            "HalfMassRadiusStars",
            1,
            np.float32,
            "snap_length",
            "Stellar half mass radius.",
            "basic",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            False,
            1,
        ),
        "HalfMassRadiusTot": (
            "HalfMassRadiusTotal",
            1,
            np.float32,
            "snap_length",
            "Total half mass radius.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            False,
            1,
        ),
        "EncloseRadius": (
            "EncloseRadius",
            1,
            np.float32,
            "snap_length",
            "Radius of the particle furthest from the halo centre",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType1/Coordinates",
                "PartType4/Coordinates",
                "PartType5/Coordinates",
            ],
            False,
            1,
        ),
        "HeliumMass": (
            "HeliumMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in helium.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractions"],
            True,
            0,
        ),
        "HydrogenMass": (
            "HydrogenMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in hydrogen.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractions"],
            True,
            0,
        ),
        "IonisedHydrogenMass": (
            "IonisedHydrogenMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in ionised hydrogen.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "LastSupernovaEventMaximumGasDensity": (
            "LastSupernovaEventMaximumGasDensity",
            1,
            np.float32,
            "snap_mass/snap_length**3",
            "Maximum gas density at the last supernova event for the last supernova event of each gas particle.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/LastSNIIThermalFeedbackDensities",
                "PartType0/LastSNIIKineticFeedbackDensities",
            ],
            True,
            None,
        ),
        "Lbaryons": (
            "AngularMomentumBaryons",
            3,
            np.float32,
            "snap_mass*snap_length**2/snap_time",
            "Total angular momentum of baryons (gas and stars), relative to the centre of potential and baryonic centre of mass velocity.",
            "baryon",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType0/Velocities",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType4/Velocities",
            ],
            True,
            2,
        ),
        "Ldm": (
            "AngularMomentumDarkMatter",
            3,
            np.float32,
            "snap_mass*snap_length**2/snap_time",
            "Total angular momentum of the dark matter, relative to the centre of potential and DM centre of mass velocity.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Coordinates", "PartType1/Masses", "PartType1/Velocities"],
            True,
            2,
        ),
        "Lgas": (
            "AngularMomentumGas",
            3,
            np.float32,
            "snap_mass*snap_length**2/snap_time",
            "Total angular momentum of the gas, relative to the centre of potential and gas centre of mass velocity.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses", "PartType0/Velocities"],
            True,
            2,
        ),
        "MedianStellarBirthDensity": (
            "MedianStellarBirthDensity",
            1,
            np.float32,
            "snap_mass/snap_length**3",
            "Median density of gas particles that were converted into a star particle.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/BirthDensities"],
            True,
            None,
        ),
        "MedianStellarBirthTemperature": (
            "MedianStellarBirthTemperature",
            1,
            np.float32,
            "snap_temperature",
            "Median temperature of gas particles that were converted into a star particle.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/BirthTemperatures"],
            True,
            None,
        ),
        "MedianStellarBirthPressure": (
            "MedianStellarBirthPressure",
            1,
            np.float64,
            "snap_temperature/snap_length**3",
            "Median pressure of gas particles that were converted into a star particle.",
            "star",
            "DMantissa21",
            False,
            ["PartType4/BirthTemperatures", "PartType4/BirthDensities"],
            True,
            None,
        ),
        "Lstar": (
            "AngularMomentumStars",
            3,
            np.float32,
            "snap_mass*snap_length**2/snap_time",
            "Total angular momentum of the stars, relative to the centre of potential and stellar centre of mass velocity.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses", "PartType4/Velocities"],
            True,
            2,
        ),
        "MaximumStellarBirthDensity": (
            "MaximumStellarBirthDensity",
            1,
            np.float32,
            "snap_mass/snap_length**3",
            "Maximum density of gas that was converted into a star particle.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/BirthDensities"],
            True,
            None,
        ),
        "MaximumStellarBirthTemperature": (
            "MaximumStellarBirthTemperature",
            1,
            np.float32,
            "snap_temperature",
            "Maximum temperature of gas that was converted into a star particle.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/BirthTemperatures"],
            True,
            None,
        ),
        "MaximumStellarBirthPressure": (
            "MaximumStellarBirthPressure",
            1,
            np.float64,
            "snap_temperature/snap_length**3",
            "Maximum pressure of gas that was converted into a star particle.",
            "star",
            "DMantissa21",
            False,
            ["PartType4/BirthTemperatures", "PartType4/BirthDensities"],
            True,
            None,
        ),
        "Mbh_dynamical": (
            "BlackHolesDynamicalMass",
            1,
            np.float32,
            "snap_mass",
            "Total BH dynamical mass.",
            "basic",
            "FMantissa9",
            False,
            ["PartType5/DynamicalMasses"],
            True,
            0,
        ),
        "Mbh_subgrid": (
            "BlackHolesSubgridMass",
            1,
            np.float32,
            "snap_mass",
            "Total BH subgrid mass.",
            "basic",
            "FMantissa9",
            False,
            ["PartType5/SubgridMasses"],
            True,
            0,
        ),
        "Mdm": (
            "DarkMatterMass",
            1,
            np.float32,
            "snap_mass",
            "Total DM mass.",
            "basic",
            "FMantissa9",
            True,
            ["PartType1/Masses"],
            True,
            0,
        ),
        "Mfrac_satellites": (
            "MassFractionSatellites",
            1,
            np.float32,
            "dimensionless",
            "Fraction of mass that is bound to a satellite in the same FOF group.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Masses",
                "PartType1/Masses",
                "PartType4/Masses",
                "PartType5/DynamicalMasses",
                "PartType0/FOFGroupIDs",
                "PartType1/FOFGroupIDs",
                "PartType4/FOFGroupIDs",
                "PartType5/FOFGroupIDs",
                "PartType0/GroupNr_bound",
                "PartType1/GroupNr_bound",
                "PartType4/GroupNr_bound",
                "PartType5/GroupNr_bound",
            ],
            True,
            0,
        ),
        "Mfrac_external": (
            "MassFractionExternal",
            1,
            np.float32,
            "dimensionless",
            "Fraction of mass that is bound to a satellite outside this FOF group.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Masses",
                "PartType1/Masses",
                "PartType4/Masses",
                "PartType5/DynamicalMasses",
                "PartType0/FOFGroupIDs",
                "PartType1/FOFGroupIDs",
                "PartType4/FOFGroupIDs",
                "PartType5/FOFGroupIDs",
                "PartType0/GroupNr_bound",
                "PartType1/GroupNr_bound",
                "PartType4/GroupNr_bound",
                "PartType5/GroupNr_bound",
            ],
            True,
            0,
        ),
        "Mgas": (
            "GasMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass.",
            "basic",
            "FMantissa9",
            False,
            ["PartType0/Masses"],
            True,
            0,
        ),
        "Mgas_SF": (
            "StarFormingGasMass",
            1,
            np.float32,
            "snap_mass",
            "Total mass of star-forming gas.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/StarFormationRates"],
            True,
            0,
        ),
        "Mhotgas": (
            "HotGasMass",
            1,
            np.float32,
            "snap_mass",
            "Total mass of gas with a temperature above 1e5 K.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/Temperatures"],
            True,
            0,
        ),
        "GasMassInColdDenseGas": (
            "GasMassInColdDenseGas",
            1,
            np.float32,
            "snap_mass",
            "Total mass of gas in cold, dense gas.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/Densities", "PartType0/Temperatures"],
            True,
            0,
        ),
        "MinimumStellarBirthDensity": (
            "MinimumStellarBirthDensity",
            1,
            np.float32,
            "snap_mass/snap_length**3",
            "Minimum density of gas that was converted into a star particle.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/BirthDensities"],
            True,
            None,
        ),
        "MinimumStellarBirthTemperature": (
            "MinimumStellarBirthTemperature",
            1,
            np.float32,
            "snap_temperature",
            "Minimum temperature of gas that was converted into a star particle.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/BirthTemperatures"],
            True,
            None,
        ),
        "MinimumStellarBirthPressure": (
            "MinimumStellarBirthPressure",
            1,
            np.float64,
            "snap_temperature/snap_length**3",
            "Minimum pressure of gas that was converted into a star particle.",
            "star",
            "DMantissa21",
            False,
            ["PartType4/BirthTemperatures", "PartType4/BirthDensities"],
            True,
            None,
        ),
        "Mnu": (
            "RawNeutrinoMass",
            1,
            np.float32,
            "snap_mass",
            "Total neutrino particle mass.",
            "basic",
            "FMantissa9",
            True,
            ["PartType6/Masses"],
            True,
            0,
        ),
        "MnuNS": (
            "NoiseSuppressedNeutrinoMass",
            1,
            np.float32,
            "snap_mass",
            "Noise suppressed total neutrino mass.",
            "basic",
            "FMantissa9",
            True,
            ["PartType6/Masses", "PartType6/Weights"],
            True,
            0,
        ),
        "MolecularHydrogenMass": (
            "MolecularHydrogenMass",
            1,
            np.float32,
            "snap_mass",
            "Total gas mass in molecular hydrogen.",
            "basic",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/SpeciesFractions",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "Mstar": (
            "StellarMass",
            1,
            np.float32,
            "snap_mass",
            "Total stellar mass.",
            "basic",
            "FMantissa9",
            False,
            ["PartType4/Masses"],
            True,
            0,
        ),
        "Mstar_init": (
            "StellarInitialMass",
            1,
            np.float32,
            "snap_mass",
            "Total stellar initial mass.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/InitialMasses"],
            True,
            0,
        ),
        "Mtot": (
            "TotalMass",
            1,
            np.float32,
            "snap_mass",
            "Total mass.",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Masses",
                "PartType1/Masses",
                "PartType4/Masses",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "Nbh": (
            "NumberOfBlackHoleParticles",
            1,
            np.uint32,
            "dimensionless",
            "Number of black hole particles.",
            "basic",
            "None",
            False,
            [],
            True,
            None,
        ),
        "Ndm": (
            "NumberOfDarkMatterParticles",
            1,
            np.uint32,
            "dimensionless",
            "Number of dark matter particles.",
            "basic",
            "None",
            True,
            [],
            True,
            None,
        ),
        "Ngas": (
            "NumberOfGasParticles",
            1,
            np.uint32,
            "dimensionless",
            "Number of gas particles.",
            "basic",
            "None",
            False,
            [],
            True,
            None,
        ),
        "Nnu": (
            "NumberOfNeutrinoParticles",
            1,
            np.uint32,
            "dimensionless",
            "Number of neutrino particles.",
            "basic",
            "None",
            False,
            [],
            True,
            None,
        ),
        "Nstar": (
            "NumberOfStarParticles",
            1,
            np.uint32,
            "dimensionless",
            "Number of star particles.",
            "basic",
            "None",
            False,
            [],
            True,
            None,
        ),
        "ProjectedTotalInertiaTensor": (
            "ProjectedTotalInertiaTensor",
            3,
            np.float32,
            "snap_length**2",
            "2D inertia tensor computed iteratively from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            2,
        ),
        "ProjectedTotalInertiaTensorReduced": (
            "ProjectedTotalInertiaTensorReduced",
            3,
            np.float32,
            "dimensionless",
            "Reduced 2D inertia tensor computed iteratively from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "ProjectedTotalInertiaTensorNoniterative": (
            "ProjectedTotalInertiaTensorNoniterative",
            3,
            np.float32,
            "snap_length**2",
            "2D inertia tensor computed in a single iteration from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            2,
        ),
        "ProjectedTotalInertiaTensorReducedNoniterative": (
            "ProjectedTotalInertiaTensorReducedNoniterative",
            3,
            np.float32,
            "dimensionless",
            "Reduced 2D inertia tensor computed in a single iteration from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "ProjectedGasInertiaTensor": (
            "ProjectedGasInertiaTensor",
            3,
            np.float32,
            "snap_length**2",
            "2D inertia tensor computed iteratively from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            2,
        ),
        "ProjectedGasInertiaTensorReduced": (
            "ProjectedGasInertiaTensorReduced",
            3,
            np.float32,
            "dimensionless",
            "Reduced 2D inertia tensor computed iteratively from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            0,
        ),
        "ProjectedGasInertiaTensorNoniterative": (
            "ProjectedGasInertiaTensorNoniterative",
            3,
            np.float32,
            "snap_length**2",
            "2D inertia tensor computed in a single iteration from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            2,
        ),
        "ProjectedGasInertiaTensorReducedNoniterative": (
            "ProjectedGasInertiaTensorReducedNoniterative",
            3,
            np.float32,
            "dimensionless",
            "Reduced 2D inertia tensor computed in a single iteration from the gas mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            True,
            0,
        ),
        "ProjectedStellarInertiaTensor": (
            "ProjectedStellarInertiaTensor",
            3,
            np.float32,
            "snap_length**2",
            "2D inertia tensor computed iteratively from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            2,
        ),
        "ProjectedStellarInertiaTensorReduced": (
            "ProjectedStellarInertiaTensorReduced",
            3,
            np.float32,
            "dimensionless",
            "Reduced 2D inertia tensor computed iteratively from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            0,
        ),
        "ProjectedStellarInertiaTensorNoniterative": (
            "ProjectedStellarInertiaTensorNoniterative",
            3,
            np.float32,
            "snap_length**2",
            "2D inertia tensor computed in a single iteration from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            2,
        ),
        "ProjectedStellarInertiaTensorReducedNoniterative": (
            "ProjectedStellarInertiaTensorReducedNoniterative",
            3,
            np.float32,
            "dimensionless",
            "Reduced 2D inertia tensor computed in a single iteration from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal value as (1,1), (2,2), (1,2). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            0,
        ),
        "R_vmax": (
            "MaximumCircularVelocityRadius",
            1,
            np.float32,
            "snap_length",
            "Radius at which Vmax is reached.",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            False,
            1,
        ),
        "SFR": (
            "StarFormationRate",
            1,
            np.float32,
            "snap_mass/snap_time",
            "Total star formation rate.",
            "basic",
            "FMantissa9",
            False,
            ["PartType0/StarFormationRates"],
            True,
            None,
        ),
        "StellarInertiaTensor": (
            "StellarInertiaTensor",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed iteratively from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            2,
        ),
        "StellarInertiaTensorReduced": (
            "StellarInertiaTensorReduced",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed iteratively from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            0,
        ),
        "StellarInertiaTensorNoniterative": (
            "StellarInertiaTensorNoniterative",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed in a single iteration from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            2,
        ),
        "StellarInertiaTensorReducedNoniterative": (
            "StellarInertiaTensorReducedNoniterative",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed in a single iteration from the stellar mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            True,
            0,
        ),
        "StellarLuminosity": (
            "StellarLuminosity",
            9,
            np.float32,
            "dimensionless",
            "Total stellar luminosity in the 9 GAMA bands.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Luminosities"],
            True,
            None,
        ),
        "Tgas": (
            "GasTemperature",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures"],
            True,
            0,
        ),
        "Tgas_no_agn": (
            "GasTemperatureWithoutRecentAGNHeating",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature, excluding gas that was recently heated by AGN.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures", "PartType0/LastAGNFeedbackScaleFactors"],
            True,
            0,
        ),
        "Tgas_no_cool": (
            "GasTemperatureWithoutCoolGas",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature, excluding cool gas with a temperature below 1e5 K.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures"],
            True,
            0,
        ),
        "Tgas_no_cool_no_agn": (
            "GasTemperatureWithoutCoolGasAndRecentAGNHeating",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature, excluding cool gas with a temperature below 1e5 K and gas that was recently heated by AGN.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures", "PartType0/LastAGNFeedbackScaleFactors"],
            True,
            0,
        ),
        "Tgas_cy_weighted": (
            "GasComptonYTemperature",
            1,
            np.float32,
            "snap_temperature",
            "ComptonY-weighted mean gas temperature.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures", "PartType0/ComptonYParameters"],
            True,
            0,
        ),
        "Tgas_cy_weighted_no_agn": (
            "GasComptonYTemperatureWithoutRecentAGNHeating",
            1,
            np.float32,
            "snap_temperature",
            "ComptonY-weighted mean gas temperature, excluding gas that was recently heated by AGN.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/ComptonYParameters",
                "PartType0/LastAGNFeedbackScaleFactors",
            ],
            True,
            0,
        ),
        "Tgas_cy_weighted_core_excision": (
            "GasComptonYTemperatureCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "ComptonY-weighted mean gas temperature, excluding the inner {core_excision}.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/ComptonYParameters",
                "PartType0/Coordinates",
            ],
            True,
            0,
        ),
        "Tgas_cy_weighted_core_excision_no_agn": (
            "GasComptonYTemperatureWithoutRecentAGNHeatingCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "ComptonY-weighted mean gas temperature, excluding the inner {core_excision} and gas that was recently heated by AGN.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/ComptonYParameters",
                "PartType0/Coordinates",
                "PartType0/LastAGNFeedbackScaleFactors",
            ],
            True,
            0,
        ),
        "Tgas_core_excision": (
            "GasTemperatureCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature, excluding the inner {core_excision}.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures", "PartType0/Masses", "PartType0/Coordinates"],
            True,
            0,
        ),
        "Tgas_no_cool_core_excision": (
            "GasTemperatureWithoutCoolGasCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature, excluding the inner {core_excision} and gas below 1e5 K.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures", "PartType0/Masses", "PartType0/Coordinates"],
            True,
            0,
        ),
        "Tgas_no_agn_core_excision": (
            "GasTemperatureWithoutRecentAGNHeatingCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature, excluding the inner {core_excision}, and gas that was recently heated by AGN.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/Masses",
                "PartType0/Coordinates",
                "PartType0/LastAGNFeedbackScaleFactors",
            ],
            True,
            0,
        ),
        "Tgas_no_cool_no_agn_core_excision": (
            "GasTemperatureWithoutCoolGasAndRecentAGNHeatingCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "Mass-weighted mean gas temperature, excluding the inner {core_excision}, gas below 1e5 K and gas that was recently heated by AGN.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/Masses",
                "PartType0/Coordinates",
                "PartType0/LastAGNFeedbackScaleFactors",
            ],
            True,
            0,
        ),
        "TotalInertiaTensor": (
            "TotalInertiaTensor",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed iteratively from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            2,
        ),
        "TotalInertiaTensorReduced": (
            "TotalInertiaTensorReduced",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed iteratively from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "TotalInertiaTensorNoniterative": (
            "TotalInertiaTensorNoniterative",
            6,
            np.float32,
            "snap_length**2",
            "3D inertia tensor computed in a single iteration from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            2,
        ),
        "TotalInertiaTensorReducedNoniterative": (
            "TotalInertiaTensorReducedNoniterative",
            6,
            np.float32,
            "dimensionless",
            "Reduced 3D inertia tensor computed in a single iteration from the total mass distribution, relative to the halo centre. Diagonal components and one off-diagonal triangle as (1,1), (2,2), (3,3), (1,2), (1,3), (2,3). Only calculated when we have more than 20 particles.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "TotalSNIaRate": (
            "TotalSNIaRate",
            1,
            np.float32,
            "1/snap_time",
            "Total SNIa rate.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/SNIaRates"],
            True,
            None,
        ),
        "Vmax": (
            "MaximumCircularVelocity",
            1,
            np.float32,
            "snap_length/snap_time",
            "Maximum circular velocity.",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "Vmax_soft": (
            "MaximumCircularVelocitySoft",
            1,
            np.float32,
            "snap_length/snap_time",
            "Maximum circular velocity when accounting for softening length.",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "DM_Vmax": (
            "MaximumDarkMatterCircularVelocity",
            1,
            np.float32,
            "snap_length/snap_time",
            "Maximum circular velocity.",
            "basic",
            "FMantissa9",
            False,
            [
                "PartType1/Coordinates",
                "PartType1/Masses",
            ],
            True,
            0,
        ),
        "Xraylum": (
            "XRayLuminosity",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total observer-frame Xray luminosity in three bands.",
            "general",
            "DMantissa21",
            False,
            ["PartType0/XrayLuminosities"],
            True,
            None,
        ),
        "Xraylum_restframe": (
            "XRayLuminosityInRestframe",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total rest-frame Xray luminosity in three bands.",
            "general",
            "DMantissa21",
            False,
            # Can't include PartType0/XrayLuminositiesRestframe as it is
            # calculated by SOAP. The following properties are required
            # for the Xray calculator (which computes restframe quantities).
            [
                "PartType0/XrayLuminosities",
                "PartType0/Densities",
                "PartType0/Temperatures",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "Xraylum_no_agn": (
            "XRayLuminosityWithoutRecentAGNHeating",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total observer-frame Xray luminosity in three bands. Excludes gas that was recently heated by AGN.",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/XrayLuminosities",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Temperatures",
            ],
            True,
            None,
        ),
        "Xraylum_restframe_no_agn": (
            "XRayLuminosityInRestframeWithoutRecentAGNHeating",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total rest-frame Xray luminosity in three bands. Excludes gas that was recently heated by AGN.",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/XrayLuminosities",
                "PartType0/Densities",
                "PartType0/Temperatures",
                "PartType0/ElementMassFractions",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Temperatures",
            ],
            True,
            0,
        ),
        "Xraylum_core_excision": (
            "XRayLuminosityCoreExcision",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total observer-frame Xray luminosity in three bands. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            ["PartType0/XrayLuminosities", "PartType0/Coordinates"],
            True,
            None,
        ),
        "Xraylum_restframe_core_excision": (
            "XRayLuminosityInRestframeCoreExcision",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total rest-frame Xray luminosity in three bands. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/Densities",
                "PartType0/Temperatures",
                "PartType0/ElementMassFractions",
                "PartType0/Coordinates",
            ],
            True,
            0,
        ),
        "Xraylum_no_agn_core_excision": (
            "XRayLuminosityWithoutRecentAGNHeatingCoreExcision",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total observer-frame Xray luminosity in three bands. Excludes gas that was recently heated by AGN. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/XrayLuminosities",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Temperatures",
                "PartType0/Coordinates",
            ],
            True,
            None,
        ),
        "Xraylum_restframe_no_agn_core_excision": (
            "XRayLuminosityInRestframeWithoutRecentAGNHeatingCoreExcision",
            3,
            np.float64,
            "snap_mass*snap_length**2/snap_time**3",
            "Total rest-frame Xray luminosity in three bands. Excludes gas that was recently heated by AGN. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/Densities",
                "PartType0/Temperatures",
                "PartType0/ElementMassFractions",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Coordinates",
            ],
            True,
            0,
        ),
        "Xrayphlum": (
            "XRayPhotonLuminosity",
            3,
            np.float64,
            "1/snap_time",
            "Total observer-frame Xray photon luminosity in three bands.",
            "general",
            "DMantissa21",
            False,
            ["PartType0/XrayPhotonLuminosities"],
            True,
            None,
        ),
        "Xrayphlum_restframe": (
            "XRayPhotonLuminosityInRestframe",
            3,
            np.float64,
            "1/snap_time",
            "Total rest-frame Xray photon luminosity in three bands.",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/XrayPhotonLuminosities",
                "PartType0/Densities",
                "PartType0/Temperatures",
                "PartType0/ElementMassFractions",
            ],
            True,
            0,
        ),
        "Xrayphlum_no_agn": (
            "XRayPhotonLuminosityWithoutRecentAGNHeating",
            3,
            np.float64,
            "1/snap_time",
            "Total observer-frame Xray photon luminosity in three bands. Exclude gas that was recently heated by AGN.",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/XrayPhotonLuminosities",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Temperatures",
            ],
            True,
            None,
        ),
        "Xrayphlum_restframe_no_agn": (
            "XRayPhotonLuminosityInRestframeWithoutRecentAGNHeating",
            3,
            np.float64,
            "1/snap_time",
            "Total rest-frame Xray photon luminosity in three bands. Exclude gas that was recently heated by AGN.",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/XrayPhotonLuminosities",
                "PartType0/Densities",
                "PartType0/Temperatures",
                "PartType0/ElementMassFractions",
                "PartType0/LastAGNFeedbackScaleFactors",
            ],
            True,
            0,
        ),
        "Xrayphlum_core_excision": (
            "XRayPhotonLuminosityCoreExcision",
            3,
            np.float64,
            "1/snap_time",
            "Total observer-frame Xray photon luminosity in three bands. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/Densities",  # To compute X-rays
                "PartType0/ElementMassFractions",  # To compute X-rays
                "PartType0/Temperatures",
                "PartType0/Coordinates",
            ],
            True,
            None,
        ),
        "Xrayphlum_restframe_core_excision": (
            "XRayPhotonLuminosityInRestframeCoreExcision",
            3,
            np.float64,
            "1/snap_time",
            "Total rest-frame Xray photon luminosity in three bands. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/Densities",
                "PartType0/Temperatures",
                "PartType0/ElementMassFractions",
                "PartType0/Coordinates",
            ],
            True,
            0,
        ),
        "Xrayphlum_no_agn_core_excision": (
            "XRayPhotonLuminosityWithoutRecentAGNHeatingCoreExcision",
            3,
            np.float64,
            "1/snap_time",
            "Total observer-frame Xray photon luminosity in three bands. Exclude gas that was recently heated by AGN. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/XrayPhotonLuminosities",
                "PartType0/Temperatures",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Coordinates",
            ],
            True,
            None,
        ),
        "Xrayphlum_restframe_no_agn_core_excision": (
            "XRayPhotonLuminosityInRestframeWithoutRecentAGNHeatingCoreExcision",
            3,
            np.float64,
            "1/snap_time",
            "Total rest-frame Xray photon luminosity in three bands. Exclude gas that was recently heated by AGN. Excludes gas in the inner {core_excision}",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/Densities",
                "PartType0/ElementMassFractions",
                "PartType0/Temperatures",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Coordinates",
            ],
            True,
            0,
        ),
        "SpectroscopicLikeTemperature": (
            "SpectroscopicLikeTemperature",
            1,
            np.float32,
            "snap_temperature",
            "Spectroscopic-like gas temperature.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Temperatures", "PartType0/Densities", "PartType0/Masses"],
            True,
            0,
        ),
        "SpectroscopicLikeTemperature_no_agn": (
            "SpectroscopicLikeTemperatureWithoutRecentAGNHeating",
            1,
            np.float32,
            "snap_temperature",
            "Spectroscopic-like gas temperature. Exclude gas that was recently heated by AGN",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/Densities",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Masses",
            ],
            True,
            0,
        ),
        "SpectroscopicLikeTemperature_core_excision": (
            "SpectroscopicLikeTemperatureCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "Spectroscopic-like gas temperature. Excludes gas in the inner {core_excision}",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/Densities",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Masses",
                "PartType0/Coordinates",
            ],
            True,
            0,
        ),
        "SpectroscopicLikeTemperature_no_agn_core_excision": (
            "SpectroscopicLikeTemperatureWithoutRecentAGNHeatingCoreExcision",
            1,
            np.float32,
            "snap_temperature",
            "Spectroscopic-like gas temperature. Exclude gas that was recently heated by AGN. Excludes gas in the inner {core_excision}",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Temperatures",
                "PartType0/Densities",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Masses",
                "PartType0/Coordinates",
                "PartType0/LastAGNFeedbackScaleFactors",
            ],
            True,
            0,
        ),
        "concentration": (
            "Concentration",
            1,
            np.float32,
            "dimensionless",
            "Halo concentration assuming an NFW profile.",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "concentration_soft": (
            "ConcentrationSoft",
            1,
            np.float32,
            "dimensionless",
            "Halo concentration assuming an NFW profile. Minimum particle radius set to softening length",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            True,
            0,
        ),
        "concentration_dmo": (
            "DarkMatterConcentration",
            1,
            np.float32,
            "dimensionless",
            "Concentration of dark matter particles assuming an NFW profile.",
            "basic",
            "FMantissa9",
            False,
            [
                "PartType1/Coordinates",
                "PartType1/Masses",
            ],
            True,
            0,
        ),
        "concentration_dmo_soft": (
            "DarkMatterConcentrationSoft",
            1,
            np.float32,
            "dimensionless",
            "Concentration of dark matter particles assuming an NFW profile. Minimum particle radius set to softening length",
            "basic",
            "FMantissa9",
            False,
            [
                "PartType1/Coordinates",
                "PartType1/Masses",
            ],
            True,
            0,
        ),
        "com": (
            "CentreOfMass",
            3,
            np.float64,
            "snap_length",
            "Centre of mass.",
            "basic",
            "DScale5",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
            ],
            False,
            1,
        ),
        "com_gas": (
            "GasCentreOfMass",
            3,
            np.float64,
            "snap_length",
            "Centre of mass of gas.",
            "gas",
            "DScale5",
            False,
            ["PartType0/Coordinates", "PartType0/Masses"],
            False,
            1,
        ),
        "com_star": (
            "StellarCentreOfMass",
            3,
            np.float64,
            "snap_length",
            "Centre of mass of stars.",
            "star",
            "DScale5",
            False,
            ["PartType4/Coordinates", "PartType4/Masses"],
            False,
            1,
        ),
        "compY": (
            "ComptonY",
            1,
            np.float64,
            "snap_length**2",
            "Total Compton y parameter.",
            "general",
            "DMantissa21",
            False,
            ["PartType0/ComptonYParameters"],
            True,
            0,
        ),
        "compY_no_agn": (
            "ComptonYWithoutRecentAGNHeating",
            1,
            np.float64,
            "snap_length**2",
            "Total Compton y parameter. Excludes gas that was recently heated by AGN.",
            "general",
            "DMantissa21",
            False,
            [
                "PartType0/ComptonYParameters",
                "PartType0/LastAGNFeedbackScaleFactors",
                "PartType0/Temperatures",
            ],
            True,
            0,
        ),
        "gasFefrac": (
            "GasMassFractionInIron",
            1,
            np.float32,
            "dimensionless",
            "Total gas mass fraction in iron.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractions"],
            True,
            0,
        ),
        "gasFefrac_SF": (
            "StarFormingGasMassFractionInIron",
            1,
            np.float32,
            "dimensionless",
            "Total gas mass fraction in iron for gas that is star-forming.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractions",
                "PartType0/StarFormationRates",
            ],
            True,
            0,
        ),
        "gasOfrac": (
            "GasMassFractionInOxygen",
            1,
            np.float32,
            "dimensionless",
            "Total gas mass in oxygen.",
            "general",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/ElementMassFractions"],
            True,
            0,
        ),
        "gasOfrac_SF": (
            "StarFormingGasMassFractionInOxygen",
            1,
            np.float32,
            "dimensionless",
            "Total gas mass fraction in oxygen for gas that is star-forming.",
            "general",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractions",
                "PartType0/StarFormationRates",
            ],
            True,
            0,
        ),
        "gasmetalfrac": (
            "GasMassFractionInMetals",
            1,
            np.float32,
            "dimensionless",
            "Total gas mass fraction in metals.",
            "basic",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/MetalMassFractions"],
            True,
            0,
        ),
        "gasmetalfrac_SF": (
            "StarFormingGasMassFractionInMetals",
            1,
            np.float32,
            "dimensionless",
            "Total gas mass fraction in metals for gas that is star-forming.",
            "basic",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/MetalMassFractions",
                "PartType0/StarFormationRates",
            ],
            True,
            0,
        ),
        "kappa_corot_baryons": (
            "KappaCorotBaryons",
            1,
            np.float32,
            "dimensionless",
            "Kappa-corot for baryons (gas and stars), relative to the centre of potential and the centre of mass velocity of the baryons.",
            "baryon",
            "FMantissa9",
            False,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType0/Velocities",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType4/Velocities",
            ],
            True,
            0,
        ),
        "kappa_corot_gas": (
            "KappaCorotGas",
            1,
            np.float32,
            "dimensionless",
            "Kappa-corot for gas, relative to the centre of potential and the centre of mass velocity of the gas.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Coordinates", "PartType0/Masses", "PartType0/Velocities"],
            True,
            0,
        ),
        "kappa_corot_star": (
            "KappaCorotStars",
            1,
            np.float32,
            "dimensionless",
            "Kappa-corot for stars, relative to the centre of potential and the centre of mass velocity of the stars.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Coordinates", "PartType4/Masses", "PartType4/Velocities"],
            True,
            0,
        ),
        "proj_veldisp_dm": (
            "DarkMatterProjectedVelocityDispersion",
            1,
            np.float32,
            "snap_length/snap_time",
            "Mass-weighted velocity dispersion of the DM along the projection axis, relative to the DM centre of mass velocity.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Velocities"],
            True,
            1,
        ),
        "proj_veldisp_gas": (
            "GasProjectedVelocityDispersion",
            1,
            np.float32,
            "snap_length/snap_time",
            "Mass-weighted velocity dispersion of the gas along the projection axis, relative to the gas centre of mass velocity.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Velocities"],
            True,
            1,
        ),
        "proj_veldisp_star": (
            "StellarProjectedVelocityDispersion",
            1,
            np.float32,
            "snap_length/snap_time",
            "Mass-weighted velocity dispersion of the stars along the projection axis, relative to the stellar centre of mass velocity.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Velocities"],
            True,
            1,
        ),
        "r": (
            "SORadius",
            1,
            np.float32,
            "snap_length",
            "Radius of a sphere {label}",
            "basic",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
                "PartType6/Coordinates",
                "PartType6/Masses",
                "PartType6/Weights",
            ],
            False,
            1,
        ),
        "spin_parameter": (
            "SpinParameter",
            1,
            np.float32,
            "dimensionless",
            "Bullock et al. (2001) spin parameter.",
            "general",
            "FMantissa9",
            True,
            [
                "PartType0/Coordinates",
                "PartType0/Masses",
                "PartType0/Velocities",
                "PartType1/Coordinates",
                "PartType1/Masses",
                "PartType1/Velocities",
                "PartType4/Coordinates",
                "PartType4/Masses",
                "PartType4/Velocities",
                "PartType5/Coordinates",
                "PartType5/DynamicalMasses",
                "PartType5/Velocities",
            ],
            True,
            0,
        ),
        "starFefrac": (
            "StellarMassFractionInIron",
            1,
            np.float32,
            "dimensionless",
            "Total stellar mass fraction in iron.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/ElementMassFractions"],
            True,
            0,
        ),
        "starMgfrac": (
            "StellarMassFractionInMagnesium",
            1,
            np.float32,
            "dimensionless",
            "Total stellar mass fraction in magnesium.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/ElementMassFractions"],
            True,
            0,
        ),
        "starOfrac": (
            "StellarMassFractionInOxygen",
            1,
            np.float32,
            "dimensionless",
            "Total stellar mass fraction in oxygen.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/ElementMassFractions"],
            True,
            0,
        ),
        "starmetalfrac": (
            "StellarMassFractionInMetals",
            1,
            np.float32,
            "dimensionless",
            "Total stellar mass fraction in metals.",
            "basic",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/MetalMassFractions"],
            True,
            0,
        ),
        "stellar_age_lw": (
            "LuminosityWeightedMeanStellarAge",
            1,
            np.float32,
            "snap_time",
            "Luminosity weighted mean stellar age. The weight is the r band luminosity.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Luminosities", "PartType4/BirthScaleFactors"],
            True,
            None,
        ),
        "stellar_age_mw": (
            "MassWeightedMeanStellarAge",
            1,
            np.float32,
            "snap_time",
            "Mass weighted mean stellar age.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/BirthScaleFactors"],
            True,
            None,
        ),
        "vcom": (
            "CentreOfMassVelocity",
            3,
            np.float32,
            "snap_length/snap_time",
            "Centre of mass velocity.",
            "basic",
            "DScale1",
            True,
            [
                "PartType0/Masses",
                "PartType0/Velocities",
                "PartType1/Masses",
                "PartType1/Velocities",
                "PartType4/Masses",
                "PartType4/Velocities",
                "PartType5/DynamicalMasses",
                "PartType5/Velocities",
            ],
            False,
            1,
        ),
        "vcom_gas": (
            "GasCentreOfMassVelocity",
            3,
            np.float32,
            "snap_length/snap_time",
            "Centre of mass velocity of gas.",
            "gas",
            "DScale1",
            False,
            ["PartType0/Masses", "PartType0/Velocities"],
            False,
            1,
        ),
        "vcom_star": (
            "StellarCentreOfMassVelocity",
            3,
            np.float32,
            "snap_length/snap_time",
            "Centre of mass velocity of stars.",
            "star",
            "DScale1",
            False,
            ["PartType4/Masses", "PartType4/Velocities"],
            False,
            1,
        ),
        "veldisp_matrix_dm": (
            "DarkMatterVelocityDispersionMatrix",
            6,
            np.float32,
            "snap_length**2/snap_time**2",
            "Mass-weighted velocity dispersion of the dark matter. Measured relative to the DM centre of mass velocity. The order of the components of the dispersion tensor is XX YY ZZ XY XZ YZ.",
            "dm",
            "FMantissa9",
            True,
            ["PartType1/Masses", "PartType1/Velocities"],
            True,
            2,
        ),
        "veldisp_matrix_gas": (
            "GasVelocityDispersionMatrix",
            6,
            np.float32,
            "snap_length**2/snap_time**2",
            "Mass-weighted velocity dispersion of the gas. Measured relative to the gas centre of mass velocity. The order of the components of the dispersion tensor is XX YY ZZ XY XZ YZ.",
            "gas",
            "FMantissa9",
            False,
            ["PartType0/Masses", "PartType0/Velocities"],
            True,
            2,
        ),
        "veldisp_matrix_star": (
            "StellarVelocityDispersionMatrix",
            6,
            np.float32,
            "snap_length**2/snap_time**2",
            "Mass-weighted velocity dispersion of the stars. Measured relative to the stellar centre of mass velocity. The order of the components of the dispersion tensor is XX YY ZZ XY XZ YZ.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/Velocities"],
            True,
            2,
        ),
        "LinearMassWeightedOxygenOverHydrogenOfGas": (
            "LinearMassWeightedOxygenOverHydrogenOfGas",
            1,
            np.float32,
            "snap_mass",
            "Linear sum of the oxygen over hydrogen ratio of gas, multiplied with the gas mass.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LinearMassWeightedNitrogenOverOxygenOfGas": (
            "LinearMassWeightedNitrogenOverOxygenOfGas",
            1,
            np.float32,
            "snap_mass",
            "Linear sum of the total nitrogen over oxygen ratio of gas, multiplied with the gas mass.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LinearMassWeightedCarbonOverOxygenOfGas": (
            "LinearMassWeightedCarbonOverOxygenOfGas",
            1,
            np.float32,
            "snap_mass",
            "Linear sum of the total carbon over oxygen ratio of gas, multiplied with the gas mass.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LinearMassWeightedDiffuseNitrogenOverOxygenOfGas": (
            "LinearMassWeightedDiffuseNitrogenOverOxygenOfGas",
            1,
            np.float32,
            "snap_mass",
            "Linear sum of the diffuse nitrogen over oxygen ratio of gas, multiplied with the gas mass.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LinearMassWeightedDiffuseCarbonOverOxygenOfGas": (
            "LinearMassWeightedDiffuseCarbonOverOxygenOfGas",
            1,
            np.float32,
            "snap_mass",
            "Linear sum of the diffuse carbon over oxygen ratio of gas, multiplied with the gas mass.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LinearMassWeightedDiffuseOxygenOverHydrogenOfGas": (
            "LinearMassWeightedDiffuseOxygenOverHydrogenOfGas",
            1,
            np.float32,
            "snap_mass",
            "Linear sum of the diffuse oxygen over hydrogen ratio of gas, multiplied with the gas mass.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseNitrogenOverOxygenOfGasLowLimit": (
            "LogarithmicMassWeightedDiffuseNitrogenOverOxygenOfGasLowLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse nitrogen over oxygen ratio of gas, multiplied with the gas mass. Imposes a lower limit of 1.e-4 times solar N/O.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseNitrogenOverOxygenOfGasHighLimit": (
            "LogarithmicMassWeightedDiffuseNitrogenOverOxygenOfGasHighLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse nitrogen over oxygen ratio of gas, multiplied with the gas mass. Imposes a lower limit of 1.e-3 times solar N/O.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseCarbonOverOxygenOfGasLowLimit": (
            "LogarithmicMassWeightedDiffuseCarbonOverOxygenOfGasLowLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse carbon over oxygen ratio of gas, multiplied with the gas mass. Imposes a lower limit of 1.e-4 times solar C/O.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseCarbonOverOxygenOfGasHighLimit": (
            "LogarithmicMassWeightedDiffuseCarbonOverOxygenOfGasHighLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse carbon over oxygen ratio of gas, multiplied with the gas mass. Imposes a lower limit of 1.e-3 times solar C/O.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfGasLowLimit": (
            "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfGasLowLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse oxygen over hydrogen ratio of gas, multiplied with the gas mass. Imposes a lower limit of 1.e-4 times solar O/H.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfGasHighLimit": (
            "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfGasHighLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse oxygen over hydrogen ratio of gas, multiplied with the gas mass. Imposes a lower limit of 1.e-3 times solar O/H.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfAtomicGasLowLimit": (
            "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfAtomicGasLowLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse oxygen over hydrogen ratio of atomic gas, multiplied with the gas mass. Imposes a lower limit of 1.e-4 times solar O/H.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/ElementMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfAtomicGasHighLimit": (
            "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfAtomicGasHighLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse oxygen over hydrogen ratio of atomic gas, multiplied with the gas mass. Imposes a lower limit of 1.e-3 times solar O/H.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/ElementMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfMolecularGasLowLimit": (
            "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfMolecularGasLowLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse oxygen over hydrogen ratio of molecular gas, multiplied with the gas mass. Imposes a lower limit of 1.e-4 times solar O/H.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/ElementMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfMolecularGasHighLimit": (
            "LogarithmicMassWeightedDiffuseOxygenOverHydrogenOfMolecularGasHighLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the diffuse oxygen over hydrogen ratio of molecular gas, multiplied with the gas mass. Imposes a lower limit of 1.e-3 times solar O/H.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/ElementMassFractionsDiffuse",
                "PartType0/ElementMassFractions",
                "PartType0/SpeciesFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LinearMassWeightedIronOverHydrogenOfStars": (
            "LinearMassWeightedIronOverHydrogenOfStars",
            1,
            np.float32,
            "snap_mass",
            "Linear sum of the iron over hydrogen ratio of stars, multiplied with the stellar mass.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/ElementMassFractions"],
            True,
            0,
        ),
        "LogarithmicMassWeightedIronOverHydrogenOfStarsLowLimit": (
            "LogarithmicMassWeightedIronOverHydrogenOfStarsLowLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the iron over hydrogen ratio of stars, multiplied with the stellar mass. Imposes a lower limit of 1.e-4 times solar Fe/H.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/ElementMassFractions"],
            True,
            0,
        ),
        "LogarithmicMassWeightedIronOverHydrogenOfStarsHighLimit": (
            "LogarithmicMassWeightedIronOverHydrogenOfStarsHighLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the iron over hydrogen ratio of stars, multiplied with the stellar mass. Imposes a lower limit of 1.e-3 times solar Fe/H.",
            "star",
            "FMantissa9",
            False,
            ["PartType4/Masses", "PartType4/ElementMassFractions"],
            True,
            0,
        ),
        "GasMassInColdDenseDiffuseMetals": (
            "GasMassInColdDenseDiffuseMetals",
            1,
            np.float32,
            "snap_mass",
            "Sum of the diffuse metal mass in cold, dense gas.",
            "gas",
            "FMantissa9",
            False,
            [
                "PartType0/Masses",
                "PartType0/MetalMassFractions",
                "PartType0/DustMassFractions",
                "PartType0/Temperatures",
                "PartType0/Densities",
            ],
            True,
            0,
        ),
        "LogarithmicMassWeightedIronFromSNIaOverHydrogenOfStarsLowLimit": (
            "LogarithmicMassWeightedIronFromSNIaOverHydrogenOfStarsLowLimit",
            1,
            np.float32,
            "snap_mass",
            "Logarithmic sum of the iron over hydrogen ratio of stars, multiplied with the stellar mass, where only iron from SNIa is included. Imposes a lower limit of 1.e-4 times solar Fe/H.",
            "star",
            "FMantissa9",
            False,
            [
                "PartType4/Masses",
                "PartType4/ElementMassFractions",
                "PartType4/IronMassFractionsFromSNIa",
            ],
            True,
            0,
        ),
        "LinearMassWeightedIronFromSNIaOverHydrogenOfStars": (
            "LinearMassWeightedIronFromSNIaOverHydrogenOfStars",
            1,
            np.float32,
            "snap_mass",
            "Sum of the iron over hydrogen ratio of stars, multiplied with the stellar mass, where only iron from SNIa is included.",
            "star",
            "FMantissa9",
            False,
            [
                "PartType4/Masses",
                "PartType4/ElementMassFractions",
                "PartType4/IronMassFractionsFromSNIa",
            ],
            True,
            0,
        ),
        # InputHalo properties
        "cofp": (
            "HaloCentre",
            3,
            np.float64,
            "snap_length",
            "The centre of the subhalo as given by the halo finder. Used as reference for all relative positions. For VR and HBTplus this is equal to the position of the most bound particle in the subhalo.",
            "Input",
            "DScale5",
            True,
            [],
            False,
            1,
        ),
        "index": (
            "HaloCatalogueIndex",
            1,
            np.int64,
            "dimensionless",
            "Index of this halo in the original halo finder catalogue (first halo has index=0).",
            "Input",
            "None",
            True,
            [],
            True,
            None,
        ),
        "is_central": (
            "IsCentral",
            1,
            np.int64,
            "dimensionless",
            "Whether the halo finder flagged the halo as central (1) or satellite (0).",
            "Input",
            "None",
            True,
            [],
            True,
            None,
        ),
        "nr_bound_part": (
            "NumberOfBoundParticles",
            1,
            np.int64,
            "dimensionless",
            "Total number of particles bound to the subhalo.",
            "Input",
            "None",
            True,
            [],
            True,
            None,
        ),
        # Velociraptor properties
        "VR/ID": (
            "ID",
            1,
            np.uint64,
            "dimensionless",
            "ID assigned to this halo by VR.",
            "VR",
            "None",
            True,
            [],
            True,
            None,
        ),
        "VR/Parent_halo_ID": (
            "ParentHaloID",
            1,
            np.int64,
            "dimensionless",
            "VR/ID of the direct parent of this halo. -1 for field halos.",
            "VR",
            "None",
            True,
            [],
            True,
            None,
        ),
        "VR/Structuretype": (
            "StructureType",
            1,
            np.int32,
            "dimensionless",
            "Structure type identified by VR. Field halos are 10, higher numbers are for satellites.",
            "VR",
            "None",
            True,
            [],
            True,
            None,
        ),
        "VR/hostHaloID": (
            "HostHaloID",
            1,
            np.int64,
            "dimensionless",
            "VR/ID of the top level parent of this halo. -1 for field halos.",
            "VR",
            "None",
            True,
            [],
            True,
            None,
        ),
        "VR/numSubStruct": (
            "NumberOfSubstructures",
            1,
            np.uint64,
            "dimensionless",
            "Number of sub-structures within this halo.",
            "VR",
            "None",
            True,
            [],
            True,
            None,
        ),
        # HBT properties
        "HBTplus/Depth": (
            "Depth",
            1,
            np.uint64,
            "dimensionless",
            "Level of the subhalo in the merging hierarchy.",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/HostHaloId": (
            "HostFOFId",
            1,
            np.int64,
            "dimensionless",
            "ID of the host FOF halo of this subhalo. Hostless halos have HostFOFId == -1",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/TrackId": (
            "TrackId",
            1,
            np.uint64,
            "dimensionless",
            "Unique ID for this subhalo which is consistent across snapshots.",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/SnapshotIndexOfBirth": (
            "SnapshotIndexOfBirth",
            1,
            np.int64,
            "dimensionless",
            "Snapshot when this subhalo was formed.",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/NestedParentTrackId": (
            "NestedParentTrackId",
            1,
            np.int64,
            "dimensionless",
            "TrackId of the parent of this subhalo.",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/DescendantTrackId": (
            "DescendantTrackId",
            1,
            np.int64,
            "dimensionless",
            "TrackId of the descendant of this subhalo.",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/LastMaxMass": (
            "LastMaxMass",
            1,
            np.float32,
            "snap_mass",
            "Maximum mass of this subhalo across its evolutionary history",
            "HBTplus",
            "FMantissa9",
            True,
            [],
            True,
            0,
        ),
        "HBTplus/SnapshotIndexOfLastMaxMass": (
            "SnapshotIndexOfLastMaxMass",
            1,
            np.uint64,
            "dimensionless",
            "Latest snapshot when this subhalo had its maximum mass.",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/LastMaxVmaxPhysical": (
            "LastMaxVmaxPhysical",
            1,
            np.float32,
            "snap_length/snap_time",
            "Largest value of maximum circular velocity of this subhalo across its evolutionary history",
            "HBTplus",
            "FMantissa9",
            True,
            [],
            True,
            None,
        ),
        "HBTplus/SnapshotIndexOfLastMaxVmax": (
            "SnapshotIndexOfLastMaxVmax",
            1,
            np.uint64,
            "dimensionless",
            "Latest snapshot when this subhalo had its largest maximum circular velocity.",
            "HBTplus",
            "None",
            True,
            [],
            True,
            None,
        ),
        # FOF properties
        "FOF/Centres": (
            "Centres",
            3,
            np.float64,
            "snap_length",
            "Centre of mass of the host FOF halo of this subhalo. Zero for satellite and hostless subhalos.",
            "FOF",
            "DScale5",
            True,
            [],
            False,
            1,
        ),
        "FOF/Masses": (
            "Masses",
            1,
            np.float32,
            "snap_mass",
            "Mass of the host FOF halo of this subhalo. Zero for satellite and hostless subhalos.",
            "FOF",
            "FMantissa9",
            True,
            [],
            True,
            0,
        ),
        "FOF/Sizes": (
            "Sizes",
            1,
            np.uint64,
            "dimensionless",
            "Number of particles in the host FOF halo of this subhalo. Zero for satellite and hostless subhalos.",
            "FOF",
            "None",
            True,
            [],
            True,
            None,
        ),
        # SOAP properties
        "SubhaloRankByBoundMass": (
            "SubhaloRankByBoundMass",
            1,
            np.int32,
            "dimensionless",
            "Ranking by mass of the halo within its parent field halo. Zero for the most massive halo in the field halo.",
            "SOAP",
            "None",
            True,
            [],
            True,
            None,
        ),
        "HostHaloIndex": (
            "HostHaloIndex",
            1,
            np.int64,
            "dimensionless",
            "Index (within the SOAP arrays) of the top level parent of this subhalo. -1 for central subhalos.",
            "SOAP",
            "None",
            True,
            [],
            True,
            None,
        ),
        "IncludedInReducedSnapshot": (
            "IncludedInReducedSnapshot",
            1,
            np.int32,
            "dimensionless",
            "Whether this halo is included in the reduced snapshot.",
            "SOAP",
            "None",
            True,
            [],
            True,
            None,
        ),
    }

    # halo properties derived from other properties by SOAP
    soap_properties = [
        name
        for name, info in full_property_list.items()
        if info[5] == 'SOAP'
    ]

    # object member variables
    properties: Dict[str, Dict]
    footnotes: List[str]

    def get_footnotes(self, name: str):
        """
        List all of the footnotes for a particular property. Returns an empty
        string for properties that have no footnotes.
        """
        footnotes = []
        for fnote in self.explanation.keys():
            names = self.explanation[fnote]
            if name in names:
                try:
                    i = self.footnotes.index(fnote)
                except ValueError:
                    i = len(self.footnotes)
                    self.footnotes.append(fnote)
                footnotes.append(i + 1)
        if len(footnotes) > 0:
            return f'$^{{{",".join([f"{i}" for i in footnotes])}}}$'
        else:
            return ""

    def __init__(self, parameters):
        """
        Constructor.
        """
        self.properties = {}
        self.footnotes = []
        self.parameters = parameters

    def add_properties(self, halo_property: HaloProperty, halo_type: str):
        """
        Add all the properties calculated for a particular halo type to the
        internal dictionary.
        """
        props = halo_property.property_list
        for (
            i,
            (
                prop_name,
                prop_outputname,
                prop_shape,
                prop_dtype,
                prop_units,
                prop_description,
                prop_cat,
                prop_comp,
                prop_dmo,
                prop_partprops,
                prop_physical,
                prop_a_exponent,
            ),
        ) in enumerate(props):
            # Don't include property if it's set to false in parameter file
            # Do include property if it isn't defined in parameter file
            try:
                base_halo_type = halo_type
                if halo_type in ['ExclusiveSphereProperties', 'InclusiveSphereProperties']:
                    base_halo_type = 'ApertureProperties'
                parameter_file_properties = self.parameters[base_halo_type][
                    "properties"
                ]
                # Whether to include properties missing from parameter file
                calculations = self.parameters.get("calculations", {})
                default = calculations.get("calculate_missing_properties", True)
                if not parameter_file_properties.get(prop_outputname, default):
                    continue
            except KeyError:
                pass

            units = unyt.unyt_quantity(1, units=prop_units)
            if not prop_physical:
                units = units * unyt.Unit('a') ** prop_a_exponent
            prop_units = (
                units
                .units.latex_repr.replace(
                    "\\rm{km} \\cdot \\rm{kpc}", "\\rm{kpc} \\cdot \\rm{km}"
                )
                .replace(
                    "\\frac{\\rm{km}^{2}}{\\rm{s}^{2}}", "\\rm{km}^{2} / \\rm{s}^{2}"
                )
            )

            prop_dtype = prop_dtype.__name__
            if prop_name in self.properties:
                # run some checks
                if prop_shape != self.properties[prop_name]["shape"]:
                    print("Shape mismatch!")
                    print(halo_type, prop_name, prop_shape, self.properties[prop_name])
                    exit()
                if prop_dtype != self.properties[prop_name]["dtype"]:
                    print("dtype mismatch!")
                    print(halo_type, prop_name, prop_dtype, self.properties[prop_name])
                    exit()
                if prop_units != self.properties[prop_name]["units"]:
                    print("Unit mismatch!")
                    print(halo_type, prop_name, prop_units, self.properties[prop_name])
                    exit()
                if prop_description != self.properties[prop_name]["description"]:
                    print("Description mismatch!")
                    print(
                        halo_type,
                        prop_name,
                        prop_description,
                        self.properties[prop_name],
                    )
                    exit()
                if prop_cat != self.properties[prop_name]["category"]:
                    print("Category mismatch!")
                    print(halo_type, prop_name, prop_cat, self.properties[prop_name])
                    exit()
                assert prop_outputname == self.properties[prop_name]["name"]
                self.properties[prop_name]["types"].append(halo_type)
            else:
                self.properties[prop_name] = {
                    "name": prop_outputname,
                    "shape": prop_shape,
                    "dtype": prop_dtype,
                    "units": prop_units,
                    "description": prop_description,
                    "category": prop_cat,
                    "compression": prop_comp,
                    "dmo": prop_dmo,
                    "types": [halo_type],
                    "raw": props[i],
                }

    def print_dictionary(self):
        """
        Print the internal list of properties. Useful for regenerating the
        property dictionary with additional information for each property.

        Note that his will sort the dictionary alphabetically.
        """
        names = sorted(list(self.properties.keys()))
        print("full_property_list = {")
        for name in names:
            (
                raw_name,
                raw_outputname,
                raw_shape,
                raw_dtype,
                raw_units,
                raw_description,
                raw_cat,
                raw_comp,
                raw_dmo,
                raw_partprops,
            ) = self.properties[name]["raw"]
            raw_dtype = f"np.{raw_dtype.__name__}"
            print(
                f'  "{raw_name}": ("{raw_outputname}", {raw_shape}, {raw_dtype}, "{raw_units}", "{raw_description}", "{raw_cat}", "{raw_comp}", {raw_dmo}, {raw_partprops}),'
            )
        print("}")

    def generate_tex_files(self, output_dir: str):
        """
        Outputs all the .tex files required to generate the documentation.

        The documentation consists of
          - a hand-written SOAP.tex file.
          - a table.tex
          - a footnotes.tex file which will contain the contents of
            the various hand-written footnote*.tex files
          - a version and time stamp file, called timestamp.tex
          - a filters.tex which contains the threshold value of each filter
          - a variations.tex file which contains a table of all the halo type
            variations present in the parameter file, and the filter for each

        This function regenerates the last 5 files, based on the contents of
        the internal property dictionary and the parameter file passed.
        """

        # sort the properties by category and then alphabetically within each
        # category
        category_order = ["basic", "general", "gas", "dm", "star", "baryon", "Input", "VR", "HBTplus", "FOF", "SOAP"]
        prop_names = sorted(
            self.properties.keys(),
            key=lambda key: (
                category_order.index(self.properties[key]["category"]),
                self.properties[key]["name"].lower(),
            ),
        )

        # generate the LaTeX header for a standalone table file
        headstr = """\\documentclass{article}
\\usepackage{amsmath}
\\usepackage{amssymb}
\\usepackage{longtable}
\\usepackage{pifont}
\\usepackage{pdflscape}
\\usepackage{a4wide}
\\usepackage{multirow}
\\usepackage{xcolor}

\\begin{document}"""

        # property table string: table header
        tablestr = """\\begin{landscape}
\\begin{longtable}{p{15em}llllllllll}
Name & Shape & Type & Units & SH & ES & IS & EP & SO & Category & Compression\\\\
\\multicolumn{11}{l}{\\rule{30pt}{0pt}Description}\\\\
\\hline{}\\endhead{}"""
        # keep track of the previous category to draw a line when a category
        # is finished
        prev_cat = None
        for prop_name in prop_names:
            prop = self.properties[prop_name]
            footnotes = self.get_footnotes(prop_name)
            prop_outputname = f"{prop['name']}{footnotes}"
            prop_outputname = word_wrap_name(prop_outputname)
            prop_shape = f'{prop["shape"]}'
            prop_dtype = prop["dtype"]
            prop_units = f'${prop["units"]}$' if prop["units"] != "" else "dimensionless"
            prop_cat = prop["category"]
            prop_comp = self.compression_description[prop["compression"]]
            prop_description = prop["description"].format(
                label="satisfying a spherical overdensity criterion.",
                core_excision="excised core",
            )

            checkmark = "\\ding{51}"
            xmark = "\\ding{53}"
            prop_subhalo = checkmark if "SubhaloProperties" in prop["types"] else xmark
            prop_exclusive = (
                checkmark if "ExclusiveSphereProperties" in prop["types"] else xmark
            )
            prop_inclusive = (
                checkmark if "InclusiveSphereProperties" in prop["types"] else xmark
            )
            prop_projected = (
                checkmark if "ProjectedApertureProperties" in prop["types"] else xmark
            )
            prop_SO = checkmark if "SOProperties" in prop["types"] else xmark
            table_props = [
                prop_outputname,
                prop_shape,
                prop_dtype,
                prop_units,
                prop_subhalo,
                prop_exclusive,
                prop_inclusive,
                prop_projected,
                prop_SO,
                prop_cat,
                prop_comp,
            ]
            if prop["dmo"]:
                print_table_props = [f"{{\\color{{violet}}{v}}}" for v in table_props]
                prop_description = f"{{\\color{{violet}}{prop_description}}}"
            else:
                print_table_props = list(table_props)
            if prev_cat is None:
                prev_cat = prop_cat
            if prop_cat != prev_cat:
                prev_cat = prop_cat
                tablestr += "\\hline{}"
            tablestr += "\\rule{0pt}{4ex}"
            tablestr += " & ".join([v for v in print_table_props]) + "\\\\*\n"
            tablestr += f"\\multicolumn{{11}}{{p{{15cm}}}}{{\\rule{{30pt}}{{0pt}}{prop_description}}}\\\\\n"
        tablestr += """\\end{longtable}
\\end{landscape}"""
        # standalone table file footer
        tailstr = "\\end{document}"

        # generate the documentation files
        with open(f"{output_dir}/timestamp.tex", "w") as ofile:
            ofile.write(get_version_string())
        with open(f"{output_dir}/table.tex", "w") as ofile:
            ofile.write(tablestr)
        with open(f"{output_dir}/footnotes.tex", "w") as ofile:
            for i, fnote in enumerate(self.footnotes):
                with open(f"documentation/{fnote}", "r") as ifile:
                    fnstr = ifile.read()
                fnstr = fnstr.replace("$FOOTNOTE_NUMBER$", f"{i+1}")
                ofile.write(f"{fnstr}\n\n")

        # Particle limits for each filter
        with open(f"{output_dir}/filters.tex", "w") as ofile:
            for name, filter_info in parameters['filters'].items():
                value = filter_info['limit']
                ofile.write(f'\\newcommand{{\\{name.lower()}filter}}{{{value}}}\n')

        # Create table of variations of each halo type, always add BoundSubhalo
        tablestr = """\\begin{longtable}{llcl}
 & Name & Inclusive? & Filter \\\\
 \\hline{}SH & \\verb+BoundSubhalo+ & \\ding{53} & - \\\\*\n"""
        # Add SO apertures to table
        apertures = parameters.get('SOProperties', {})
        for _, variation in apertures.get('variations', {}).items():
            name = ''
            if 'radius_multiple' in variation:
                name += f'{int(variation["radius_multiple"])}xR_'
            if variation['type'] == 'BN98':
                name += f'BN98'
            else:
                name += f'{variation["value"]:.0f}_{variation["type"]}'
            filter = variation.get('filter', 'basic')
            filter = '-' if filter == 'basic' else filter
            tablestr += f'SO & \\verb+SO/{name}+ & \\ding{{51}} & {filter} \\\\*\n'
        # Determine which ExclusiveSphere and InclusiveSphere apertures are present
        variations_ES, variations_IS = {}, {}
        apertures = parameters.get('ApertureProperties', {})
        for _, variation in apertures.get('variations', {}).items():
            if variation['inclusive']:
                variations_IS[int(variation['radius_in_kpc'])] = variation.get('filter', 'basic')
            else:
                variations_ES[int(variation['radius_in_kpc'])] = variation.get('filter', 'basic')
        # Add ExclusiveSphere apertures to table in sorted order
        for radius in sorted(variations_ES.keys()):
            filter = '-' if variations_ES[radius] == 'basic' else variations_ES[radius]
            tablestr += f'ES & \\verb+ExclusiveSphere/{radius}kpc+ & \\ding{{53}} & {filter} \\\\*\n'
        # Add InclusiveSphere apertures to table in sorted order
        for radius in sorted(variations_IS.keys()):
            filter = '-' if variations_IS[radius] == 'basic' else variations_IS[radius]
            tablestr += f'IS & \\verb+InclusiveSphere/{radius}kpc+ & \\ding{{51}} & {filter} \\\\*\n'
        # Determine which projected apertures are present
        variations_proj = {}
        apertures = parameters.get('ProjectedApertureProperties', {})
        for _, variation in apertures.get('variations', {}).items():
            variations_proj[int(variation['radius_in_kpc'])] = variation.get('filter', 'basic')
        # Add ProjectedApertures to table in sorted order
        for radius in sorted(variations_proj.keys()):
            filter = '-' if variations_proj[radius] == 'basic' else variations_proj[radius]
            tablestr += f'EP & \\verb+ProjectedAperture/{radius}kpc/projP+ & \\ding{{53}} & {filter} \\\\*\n'
        # Finish table and output to file
        tablestr += '\\end{longtable}'
        with open(f"{output_dir}/variations_table.tex", "w") as ofile:
            ofile.write(tablestr)

class DummyProperties:
    """
    Dummy HaloProperty object used to include properties which are not computed 
    for any halo type (e.g. the 'VR' properties).
    """

    def __init__(self, halo_finder):
        categories = ["SOAP", "Input", halo_finder]
        # Currently FOF properties are only stored for HBT
        if halo_finder == 'HBTplus':
            categories += ["FOF"]
        self.property_list = [
            (prop, *info)
            for prop, info in PropertyTable.full_property_list.items()
            if info[5] in categories
        ]

if __name__ == "__main__":
    """
    Standalone script execution:
    Create a PropertyTable object will all the properties from all the halo
    types and print the property table or the documentation. The latter is the
    default; the former can be achieved by changing the boolean in the condition
    below.

    You must pass a parameter file and a snapshot to run this script
    """

    from parameter_file import ParameterFile
    import sys
    import h5py

    # get all the halo types
    # we only import them here to avoid circular imports when this script is
    # imported from another script
    from aperture_properties import ExclusiveSphereProperties, InclusiveSphereProperties
    from projected_aperture_properties import ProjectedApertureProperties
    from SO_properties import SOProperties, CoreExcisedSOProperties
    from subhalo_properties import SubhaloProperties

    # Parse parameter file
    try:
        parameters = ParameterFile(sys.argv[1]).parameters
    except IndexError:
        print("No parameter file passed.")
        exit()

    # Parse snapshot file to extract base units
    try:
        with h5py.File(sys.argv[2]) as snap:
            units_cgs = {
                name: float(value[0])
                for name, value in snap["Units"].attrs.items()
            }
            unyt.define_unit(
                "snap_length",
                units_cgs["Unit length in cgs (U_L)"] * unyt.cm,
                tex_repr='\\rm{L}'
            )
            unyt.define_unit(
                "snap_mass",
                units_cgs["Unit mass in cgs (U_M)"] * unyt.g,
                tex_repr='\\rm{M}'
            )
            unyt.define_unit(
                "snap_time",
                units_cgs["Unit time in cgs (U_t)"] * unyt.s,
                tex_repr='\\rm{t}'
            )
            unyt.define_unit(
                "snap_temperature",
                units_cgs["Unit temperature in cgs (U_T)"] * unyt.K,
                tex_repr='\\rm{T}'
            )
    except IndexError:
        print("No snapshot file passed.")
        exit()
    # Define scale factor unit
    unyt.define_unit('a', 1*unyt.dimensionless, tex_repr='\\rm{a}')

    table = PropertyTable(parameters)
    # Add standard halo definitions
    table.add_properties(SubhaloProperties, "SubhaloProperties")
    table.add_properties(ExclusiveSphereProperties, "ExclusiveSphereProperties")
    table.add_properties(InclusiveSphereProperties, "InclusiveSphereProperties")
    table.add_properties(ProjectedApertureProperties, "ProjectedApertureProperties")
    # Decide whether to add core excised properties
    for _, variation in parameters['SOProperties']['variations'].items():
        if variation.get('core_excision_fraction', 0):
            table.add_properties(CoreExcisedSOProperties, "SOProperties")
            break
    else:
        table.add_properties(SOProperties, "SOProperties")
    # Add InputHalos and SOAP properties
    table.add_properties(DummyProperties(parameters['HaloFinder']['type']), "")

    table.generate_tex_files("documentation")

    # Output base units
    with open("documentation/units.tex", "w") as ofile:
        for name, symbol in [
            ('length', 'L'),
            ('mass', 'M'),
            ('time', 't'),
            ('temperature', 'T'),
        ]:
            value = units_cgs[f"Unit {name} in cgs (U_{symbol})"]
            ofile.write(f'\\newcommand{{\\{name}baseunit}}{{{value:.4g}}}\n')
        vel_kms = (1*unyt.snap_length/unyt.snap_time).to('km/s').value
        ofile.write(f'\\newcommand{{\\velbaseunit}}{{{vel_kms:.4g}}}\n')
